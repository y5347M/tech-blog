[{"data":1,"prerenderedAt":36},["ShallowReactive",2],{"useQiitaArticleDetailFetcher-537c540f82d476646bf3":3,"useQiitaAuthorizedUser":33},{"rendered_body":4,"body":5,"coediting":6,"comments_count":7,"created_at":8,"group":9,"id":10,"likes_count":11,"private":6,"reactions_count":7,"stocks_count":11,"tags":12,"title":19,"updated_at":20,"url":21,"user":22,"page_views_count":32,"team_membership":9,"organization_url_name":9,"slide":6},"\u003Ch1 data-sourcepos=\"2:1-2:8\">\n\u003Cspan id=\"前提\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E5%89%8D%E6%8F%90\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>前提\u003C/h1>\n\u003Cp data-sourcepos=\"3:1-5:30\">localstackを構築してみたので、実際にデータをPUTしてみたいと思います。\u003Cbr>\nAWSのS3APIが使用できるようなので、そちらを利用します。\u003Cbr>\n前回の記事はこちら。\u003C/p>\n\u003Cp data-sourcepos=\"7:1-7:51\">\u003Ciframe id=\"qiita-embed-content__5bcda52a8556e02c7b6539a417b7ee75\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__5bcda52a8556e02c7b6539a417b7ee75\" data-content=\"https%3A%2F%2Fqiita.com%2Fy5347M%2Fitems%2F200d3c4e23b800e433bb\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n\u003C/iframe>\n\u003C/p>\n\u003Ch1 data-sourcepos=\"9:1-9:8\">\n\u003Cspan id=\"環境\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E7%92%B0%E5%A2%83\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>環境\u003C/h1>\n\u003Cul data-sourcepos=\"10:1-14:0\">\n\u003Cli data-sourcepos=\"10:1-10:14\">macOS 11.6.4\u003C/li>\n\u003Cli data-sourcepos=\"11:1-11:23\">docker-compose: 2.0.0\u003C/li>\n\u003Cli data-sourcepos=\"12:1-12:20\">localstack: 0.14.3\u003C/li>\n\u003Cli data-sourcepos=\"13:1-14:0\">\u003Ca href=\"https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3api/index.html#cli-aws-s3api\" rel=\"nofollow noopener\" target=\"_blank\">S3API\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Ch1 data-sourcepos=\"15:1-15:8\">\n\u003Cspan id=\"手順\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E6%89%8B%E9%A0%86\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>手順\u003C/h1>\n\u003Ch3 data-sourcepos=\"18:1-18:56\">\n\u003Cspan id=\"localstackが立ち上がっているか確認する\" class=\"fragment\">\u003C/span>\u003Ca href=\"#localstack%E3%81%8C%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%8C%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>localstackが立ち上がっているか確認する\u003C/h3>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"19:1-23:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % docker ps           \nCONTAINER ID   IMAGE                          COMMAND                  CREATED          STATUS          PORTS                                             NAMES\n205ec2df7163   localstack/localstack:0.14.3   \"docker-entrypoint.sh\"   20 minutes ago   Up 20 minutes   4510-4559/tcp, 5678/tcp, 0.0.0.0:4566-&gt;4566/tcp   localstack\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Ch3 data-sourcepos=\"25:1-25:40\">\n\u003Cspan id=\"バケットの一覧を表示する\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E4%B8%80%E8%A6%A7%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>バケットの一覧を表示する\u003C/h3>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"26:1-28:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>aws s3api list-buckets --endpoint-url=http://localhost:${localstackのポート番号} --profile ${プロファイル}\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cp data-sourcepos=\"29:1-29:60\">バケットは未作成なので空になっています。\u003C/p>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"30:1-39:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % aws s3api list-buckets --endpoint-url=http://localhost:4566 --profile localstack\n{\n    \"Buckets\": [],\n    \"Owner\": {\n        \"DisplayName\": \"webfile\",\n        \"ID\": \"XXXXXXXXXXXXXXXXXXXXXXX\"\n    }\n}\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Ch3 data-sourcepos=\"41:1-41:31\">\n\u003Cspan id=\"バケットを作成する\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>バケットを作成する\u003C/h3>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"42:1-48:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>aws s3api create-bucket \n　--bucket=${バケット名} \n　--endpoint-url=http://localhost:${localstackのポート番号} \n　--profile ${プロファイル} \n　--create-bucket-configuration LocationConstraint=${リージョン}\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cp data-sourcepos=\"50:1-50:89\">--create-bucket-configurationでLocationConstraintを指定することが重要です。\u003C/p>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"51:1-60:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % aws s3api create-bucket \n　--bucket=sample-backet \n　--endpoint-url=http://localhost:4566 \n　--profile localstack \n　--create-bucket-configuration LocationConstraint=ap-northeast-1\n{\n    \"Location\": \"http://sample-backet.s3.localhost.localstack.cloud:4566/\"\n}\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cp data-sourcepos=\"62:1-62:90\">LocationConstraintを指定しなかった場合、以下のエラーが発生します。\u003C/p>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"63:1-65:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>An error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Ch3 data-sourcepos=\"67:1-67:49\">\n\u003Cspan id=\"任意の場所にファイルを作成する\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E4%BB%BB%E6%84%8F%E3%81%AE%E5%A0%B4%E6%89%80%E3%81%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>任意の場所にファイルを作成する\u003C/h3>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"68:1-70:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>touch ${ファイル名} | ls -l\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cp data-sourcepos=\"72:1-72:45\">ファイル名はなんでも良いです。\u003C/p>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"73:1-76:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % touch sample.txt | ls -l\n-rw-r--r--  1 mm  staff    0  6 13 14:45 sample.txt\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Ch3 data-sourcepos=\"78:1-78:41\">\n\u003Cspan id=\"ファイルをlocalstackにputする\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92localstack%E3%81%ABput%E3%81%99%E3%82%8B\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>ファイルをlocalstackにPUTする\u003C/h3>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"79:1-85:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>aws s3api put-object \n --bucket=${バケット名} \n --key=${ファイル名} \n --endpoint-url=http://localhost:${localstackのポート番号} \n --profile ${プロファイル} \n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"86:1-95:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % aws s3api put-object \n --bucket=sample-backet \n --key=sample.txt \n --endpoint-url=http://localhost:4566 \n --profile localstack\n{\n    \"ETag\": \"\\\"d41d8cd98f00b204e9800998ecf8427e\\\"\"\n}\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Ch3 data-sourcepos=\"97:1-97:52\">\n\u003Cspan id=\"先ほど作成したファイルを削除する\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E5%85%88%E3%81%BB%E3%81%A9%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>先ほど作成したファイルを削除する\u003C/h3>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"98:1-100:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>rm ${ファイル名} | ls -l\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cp data-sourcepos=\"102:1-102:43\">sample.txtがなくなっていますね。\u003C/p>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"103:1-106:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % rm sample.txt | ls -l\n\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Ch3 data-sourcepos=\"108:1-108:50\">\n\u003Cspan id=\"ファイルをlocalstackからgetしてくる\" class=\"fragment\">\u003C/span>\u003Ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92localstack%E3%81%8B%E3%82%89get%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8B\">\u003Ci class=\"fa fa-link\">\u003C/i>\u003C/a>ファイルをlocalstackからGETしてくる\u003C/h3>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"109:1-116:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>aws s3api get-object \n --bucket=${バケット名}  \n --key=${ファイル名} \n --endpoint-url=http://localhost:${localstackのポート番号} \n --profile ${プロファイル} \n ${ファイル名(outfile)}\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cp data-sourcepos=\"118:1-118:139\">一番最後のファイル名(outfile) は必須項目です。ローカルにgetしてくるときのファイル名を指定します。\u003C/p>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"119:1-136:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % aws s3api get-object \n --bucket=sample-backet \n --key=sample.txt \n --endpoint-url=http://localhost:4566 \n --profile localstack \n sample.txt\n{\n    \"AcceptRanges\": \"bytes\",\n    \"LastModified\": \"2022-06-13T05:48:23+00:00\",\n    \"ContentLength\": 0,\n    \"ETag\": \"\\\"d41d8cd98f00b204e9800998ecf8427e\\\"\",\n    \"VersionId\": \"null\",\n    \"ContentLanguage\": \"en-US\",\n    \"ContentType\": \"binary/octet-stream\",\n    \"Metadata\": {}\n}\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n\u003Cp data-sourcepos=\"138:1-138:43\">sample.txtをGETしてこれています。\u003C/p>\n\u003Cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"139:1-142:3\">\u003Cdiv class=\"highlight\">\u003Cpre>\u003Ccode>XXX % ls -l\n-rw-r--r--  1 mm  staff    0  6 13 14:53 sample.txt\n\u003C/code>\u003C/pre>\u003C/div>\u003C/div>\n","\n# 前提\nlocalstackを構築してみたので、実際にデータをPUTしてみたいと思います。\nAWSのS3APIが使用できるようなので、そちらを利用します。\n前回の記事はこちら。\n\nhttps://qiita.com/y5347M/items/200d3c4e23b800e433bb\n\n# 環境\n- macOS 11.6.4\n- docker-compose: 2.0.0\n- localstack: 0.14.3\n- [S3API](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3api/index.html#cli-aws-s3api)\n\n# 手順\n\n\n### localstackが立ち上がっているか確認する\n```\nXXX % docker ps           \nCONTAINER ID   IMAGE                          COMMAND                  CREATED          STATUS          PORTS                                             NAMES\n205ec2df7163   localstack/localstack:0.14.3   \"docker-entrypoint.sh\"   20 minutes ago   Up 20 minutes   4510-4559/tcp, 5678/tcp, 0.0.0.0:4566->4566/tcp   localstack\n```\n\n### バケットの一覧を表示する\n```\naws s3api list-buckets --endpoint-url=http://localhost:${localstackのポート番号} --profile ${プロファイル}\n```\nバケットは未作成なので空になっています。\n```\nXXX % aws s3api list-buckets --endpoint-url=http://localhost:4566 --profile localstack\n{\n    \"Buckets\": [],\n    \"Owner\": {\n        \"DisplayName\": \"webfile\",\n        \"ID\": \"XXXXXXXXXXXXXXXXXXXXXXX\"\n    }\n}\n```\n\n### バケットを作成する\n```\naws s3api create-bucket \n　--bucket=${バケット名} \n　--endpoint-url=http://localhost:${localstackのポート番号} \n　--profile ${プロファイル} \n　--create-bucket-configuration LocationConstraint=${リージョン}\n```\n\n--create-bucket-configurationでLocationConstraintを指定することが重要です。\n```\nXXX % aws s3api create-bucket \n　--bucket=sample-backet \n　--endpoint-url=http://localhost:4566 \n　--profile localstack \n　--create-bucket-configuration LocationConstraint=ap-northeast-1\n{\n    \"Location\": \"http://sample-backet.s3.localhost.localstack.cloud:4566/\"\n}\n```\n\nLocationConstraintを指定しなかった場合、以下のエラーが発生します。\n```\nAn error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.\n```\n\n### 任意の場所にファイルを作成する\n```\ntouch ${ファイル名} | ls -l\n```\n\nファイル名はなんでも良いです。\n```\nXXX % touch sample.txt | ls -l\n-rw-r--r--  1 mm  staff    0  6 13 14:45 sample.txt\n```\n\n### ファイルをlocalstackにPUTする\n```\naws s3api put-object \n --bucket=${バケット名} \n --key=${ファイル名} \n --endpoint-url=http://localhost:${localstackのポート番号} \n --profile ${プロファイル} \n```\n```\nXXX % aws s3api put-object \n --bucket=sample-backet \n --key=sample.txt \n --endpoint-url=http://localhost:4566 \n --profile localstack\n{\n    \"ETag\": \"\\\"d41d8cd98f00b204e9800998ecf8427e\\\"\"\n}\n```\n\n### 先ほど作成したファイルを削除する\n```\nrm ${ファイル名} | ls -l\n```\n\nsample.txtがなくなっていますね。\n```\nXXX % rm sample.txt | ls -l\n\n```\n\n### ファイルをlocalstackからGETしてくる\n```\naws s3api get-object \n --bucket=${バケット名}  \n --key=${ファイル名} \n --endpoint-url=http://localhost:${localstackのポート番号} \n --profile ${プロファイル} \n ${ファイル名(outfile)}\n```\n\n一番最後のファイル名(outfile) は必須項目です。ローカルにgetしてくるときのファイル名を指定します。\n```\nXXX % aws s3api get-object \n --bucket=sample-backet \n --key=sample.txt \n --endpoint-url=http://localhost:4566 \n --profile localstack \n sample.txt\n{\n    \"AcceptRanges\": \"bytes\",\n    \"LastModified\": \"2022-06-13T05:48:23+00:00\",\n    \"ContentLength\": 0,\n    \"ETag\": \"\\\"d41d8cd98f00b204e9800998ecf8427e\\\"\",\n    \"VersionId\": \"null\",\n    \"ContentLanguage\": \"en-US\",\n    \"ContentType\": \"binary/octet-stream\",\n    \"Metadata\": {}\n}\n```\n\nsample.txtをGETしてこれています。\n```\nXXX % ls -l\n-rw-r--r--  1 mm  staff    0  6 13 14:53 sample.txt\n```\n",false,0,"2022-06-13T14:58:00+09:00",null,"537c540f82d476646bf3",1,[13,16],{"name":14,"versions":15},"AWS",[],{"name":17,"versions":18},"LocalStack",[],"S3APIを使用してlocalstackにデータをPUTしてみる","2022-06-14T14:40:24+09:00","https://qiita.com/y5347M/items/537c540f82d476646bf3",{"description":23,"facebook_id":24,"followees_count":25,"followers_count":11,"github_login_name":26,"id":26,"items_count":27,"linkedin_id":24,"location":24,"name":26,"organization":24,"permanent_id":28,"profile_image_url":29,"team_only":6,"twitter_screen_name":30,"website_url":31},"バックエンドエンジニアをしています。","",5,"y5347M",18,2433961,"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/2433961/a4773675e7566e225738c8c15f9fda53e35bd799/large.png?1741427719","mmmm16089306","https://twitter.com/mmmm16089306",2541,{"description":23,"facebook_id":24,"followees_count":25,"followers_count":11,"github_login_name":26,"id":26,"items_count":27,"linkedin_id":24,"location":24,"name":26,"organization":24,"permanent_id":28,"profile_image_url":29,"team_only":6,"twitter_screen_name":30,"website_url":31,"image_monthly_upload_limit":34,"image_monthly_upload_remaining":35},104857600,101432560,1745893163181]